<!DOCTYPE html>
<html>
	<head>
		<title>Miro Trends (regression-js)</title>
		<script src="http://code.jquery.com/jquery.min.js"></script>
		<script src="jquery.flot.js"></script>
		<script src="immutable.min.js"></script>
		<script src="../src/regression.js"></script>		
		<script src="../src/TrendsHelper.js"></script>		

		<script>

		$(function(){

			// Data
			var data = [[1476302388975,79.85977936467556],[1476302395975,61.41041243267354],[1476302396973,58.78316357021663],[1476302399976,60.33754952651546],[1476302400974,54.5102794787489],[1476302405972,41.207632236898824],[1476302406973,38.98656755113285],[1476302407972,36.996828968249204],[1476302408975,39.241472466151535],[1476302409972,37.74461002011774],[1476302410973,28.48975017681237],[1476302411971,31.471076216227974],[1476302414975,29.61001909017613],[1476302415975,33.18465796806407],[1476302417971,30.882952375939585],[1476302419972,28.98702331885507],[1476302420973,24.743400792315107],[1476302421972,24.6006949611447],[1476302423974,28.576836215048345],[1476302427974,21.311271831937088],[1476302428972,25.613674362110192],[1476302429974,21.954610322861523],[1476302432972,31.190133450671393],[1476302434974,24.208372407516947],[1476302436974,29.419736119258914],[1476302438973,26.879392034909724],[1476302440973,37.347953826621584],[1476302445974,45.63153443450464],[1476302446974,47.22173031801307],[1476302449970,44.15691063591684],[1476302451973,51.5509863564778],[1476302452974,57.26229195973365],[1476302454974,60.67349146884253],[1476302456974,56.03626559497977],[1476302458973,59.29350492300145],[1476302461972,63.867335350552636],[1476302462970,73.27504703537457],[1476302469970,76.79605060692097],[1476302470973,81.39855329502537],[1476302475973,81.77911438076613],[1476302476974,80.64816919043757],[1476302483974,63.12122941617823],[1476302488969,64.74868330839296],[1476302492973,52.458248605646716],[1476302496969,51.27183324410875],[1476302497973,45.39445146371664],[1476302501973,46.04088326207375],[1476302503973,41.58714983055068],[1476302505972,29.433862151073352],[1476302506971,31.515711025171143],[1476302507969,25.72609319814721],[1476302508969,28.07419619582349],[1476302509972,26.571981258841188],[1476302511972,28.07823075122152],[1476302512973,23.095042869099085],[1476302514970,25.67879027677033],[1476302515968,21.2430741584503],[1476302518972,24.978887845591412],[1476302519969,21.21453287704027],[1476302520972,21.59804836125523],[1476302522969,22.191968558470272],[1476302527969,20.792745879095655],[1476302532967,28.84322414105451],[1476302534967,35.24677049684375],[1476302536970,34.076080610579346],[1476302537971,31.63768978159084],[1476302538972,37.29196329558706],[1476302539971,43.02182340593791],[1476302540970,44.83156069393042],[1476302541972,42.717130896526776],[1476302542970,44.65045252700092],[1476302545968,46.71927784672579],[1476302546968,52.790607521142256],[1476302548970,60.935711814119436],[1476302550971,61.00029485003285],[1476302553967,66.10530569929202],[1476302555968,67.72544583577432],[1476302556968,72.44379182879142],[1476302557971,69.11014160042252],[1476302559969,70.3005956718549],[1476302561969,71.34075258538277],[1476302562967,75.81107706758046],[1476302563966,72.25346309601603],[1476302565971,77.04953724846793],[1476302566969,73.39843483074058],[1476302567969,69.7119758670161]];

			
			var dataSet        = Immutable.fromJS(data);
			var startTime      = '1476302388975';
			var endTime        = '1476302567969';
			var numberOfTrends = 20;
			var slopes         = {'SPEED':[],'SPEED2':[]};

			//SPEED SET
			var microTrends    = TrendsHelper.getMicroTrends(dataSet,startTime,endTime,'linear',numberOfTrends);
			var chartSeties    = [{data: data, lines: { show: true }, points: { show: false }, label: 'SPEED', 
								  color: '#757575'}];
			 microTrends.forEach(function(microTrend,idx) {
			    chartSeties.push({data: microTrend, color:'#ff9bbd'});
			    slopes['SPEED'][idx] = TrendsHelper.getSlope(microTrend);
			 });
			
			//SPEED 2 SET
			var newData = [];
			data.forEach(function(value,id) {
				newData.push([value[0],value[1]+30]);
			});
			var newDataSet = Immutable.fromJS(newData);
			microTrends    = TrendsHelper.getMicroTrends(newDataSet,startTime,endTime,'linear',numberOfTrends);
			chartSeties.push({data: newData, lines: { show: true }, points: { show: false }, label: 'SPEED 2', 
						      color: '#7c79e0'});
			 microTrends.forEach(function(microTrend,idx) {
			    chartSeties.push({data: microTrend, color:'#ffc107'});
			    slopes['SPEED2'][idx] = TrendsHelper.getSlope(microTrend);
			 });

			//Plot data			
			$.plot($('.graph'), chartSeties);			

			//Create Slopes Table
			slopes.SPEED.forEach(function(slope,idx) {
				$('.slopes').append('<tr style="color:#757575"><td>SPEED</td><td>'+(idx+1)+'</td><td>'+slope+'</td></tr>');
				$('.slopes').append('<tr style="color:#7c79e0"><td>SPEED2</td><td>'+(idx+1)+'</td><td>'+slopes.SPEED2[idx]+'</td></tr>');    
			});
			


		});

		</script>

		<style>
			html, body{
				margin: 0;
				padding: 0;
				font-family: "Helvetica", sans-serif;
				text-align: center;

			}
			.container{
				margin: 0 auto;
				width: 1170px;
			}
			.graph{
				width: 1170px;
				height: 500px;
			}
		</style>

	</head>
	<body>
		<div class="container">
			<h1>Miro Trends (regression-js)</h1>
			<div class="graph"></div>
			<h2></h2>
		</div>
		<table class="slopes">
			<tr>
				<th>SENSOR</th>
				<th>MICRO TREND</th>
				<th>SLOPE</th>
			</rh>
		</table>
	</body>
</html>
<style>
.slopes {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    text-align: left;
    padding: 8px;
}

th {
    background-color: #4CAF50;
    color: white;
}

tr:nth-child(even){background-color: #f2f2f2}
</style>